-- =====================================================
-- Blue Pharma Logistics - KPI Measures (Power BI / DAX)
-- =====================================================

-- üì¶ PERFORMANCE INDICATORS

-- 1Ô∏è‚É£ Total Deliveries
Total Deliveries =
COUNTROWS(Deliveries)

-- 2Ô∏è‚É£ On-Time Deliveries
On-Time Deliveries =
CALCULATE(
    COUNTROWS(Deliveries),
    Deliveries[OnTime] = TRUE()
)

-- 3Ô∏è‚É£ Compliance Rate (% on-time deliveries)
Compliance Rate =
DIVIDE(
    [On-Time Deliveries],
    [Total Deliveries],
    0
)

-- 4Ô∏è‚É£ Total Orders
Total Orders =
COUNTROWS(Orders)

-- 5Ô∏è‚É£ Service Level (% of delivered orders)
Service Level =
DIVIDE(
    CALCULATE(COUNTROWS(Orders), Orders[Status] = "Delivered"),
    [Total Orders],
    0
)

-- üïí TRANSIT & TIME KPIs

-- 6Ô∏è‚É£ Average Transit Time (days)
Average Transit Time (days) =
AVERAGEX(
    Deliveries,
    DATEDIFF(Deliveries[DepartureDate], Deliveries[ArrivalDate], DAY)
)

-- 7Ô∏è‚É£ Max Transit Time (days)
Max Transit Time (days) =
MAXX(
    Deliveries,
    DATEDIFF(Deliveries[DepartureDate], Deliveries[ArrivalDate], DAY)
)

-- 8Ô∏è‚É£ Min Transit Time (days)
Min Transit Time (days) =
MINX(
    Deliveries,
    DATEDIFF(Deliveries[DepartureDate], Deliveries[ArrivalDate], DAY)
)

-- üí∞ COST INDICATORS

-- 9Ô∏è‚É£ Total Logistic Cost
Total Logistic Cost =
SUM(Deliveries[Cost])

-- üîü Average Delivery Cost
Average Delivery Cost =
AVERAGE(Deliveries[Cost])

-- 11Ô∏è‚É£ Cost per On-Time Delivery
Cost per On-Time Delivery =
DIVIDE(
    [Total Logistic Cost],
    [On-Time Deliveries],
    0
)

-- üìà VOLUME & TREND ANALYSIS

-- 12Ô∏è‚É£ Deliveries over Time
Deliveries Over Time =
COUNTROWS(Deliveries)

-- 13Ô∏è‚É£ On-Time Deliveries Trend (Last 30 Days)
On-Time Deliveries Trend (Last 30 Days) =
CALCULATE(
    [Compliance Rate],
    DATESINPERIOD('Date'[Date], MAX('Date'[Date]), -30, DAY)
)

-- 14Ô∏è‚É£ Orders by Product Category
Orders by Product Category =
CALCULATE(
    COUNTROWS(Orders),
    VALUES(Products[Category])
)

-- üìÖ TIME INTELLIGENCE KPIs

-- 15Ô∏è‚É£ Deliveries YTD
Deliveries YTD =
TOTALYTD(
    [Total Deliveries],
    'Date'[Date]
)

-- 16Ô∏è‚É£ Deliveries MTD
Deliveries MTD =
TOTALMTD(
    [Total Deliveries],
    'Date'[Date]
)

-- 17Ô∏è‚É£ Compliance Rate YoY
Compliance Rate YoY =
CALCULATE(
    [Compliance Rate],
    SAMEPERIODLASTYEAR('Date'[Date])
)

-- 18Ô∏è‚É£ Cost YTD
Total Logistic Cost YTD =
TOTALYTD(
    [Total Logistic Cost],
    'Date'[Date]
)

-- 19Ô∏è‚É£ MoM Delivery Growth (%)
MoM Delivery Growth (%) =
VAR PrevMonth =
    CALCULATE([Total Deliveries], DATEADD('Date'[Date], -1, MONTH))
RETURN
DIVIDE([Total Deliveries] - PrevMonth, PrevMonth, 0)

-- 20Ô∏è‚É£ YoY Cost Growth (%)
YoY Cost Growth (%) =
VAR PrevYear =
    CALCULATE([Total Logistic Cost], SAMEPERIODLASTYEAR('Date'[Date]))
RETURN
DIVIDE([Total Logistic Cost] - PrevYear, PrevYear, 0)
